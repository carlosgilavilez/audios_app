const x=(()=>{const s=e=>document.getElementById(e),t=s("pl-audio"),q=s("sticky-player"),k=s("pl-play"),D=s("pl-play-icon"),F=s("pl-pause-icon"),M=s("pl-prev"),I=s("pl-next"),y=s("pl-title"),m=s("pl-author"),l=s("pl-seek"),A=s("pl-current"),O=s("pl-duration"),N=s("pl-volume"),C=s("pl-rate"),f=s("pl-download");let i=[],r=-1,v=!1;const h=e=>Number.isFinite(e)?`${Math.floor(e/60)}:${String(Math.floor(e%60)).padStart(2,"0")}`:"0:00",L=()=>{q.classList.remove("hidden"),requestAnimationFrame(()=>q.classList.remove("opacity-0","translate-y-2"))},n=e=>{D.classList.toggle("hidden",e),F.classList.toggle("hidden",!e),k.setAttribute("aria-label",e?"Pausar":"Reproducir")},p=()=>document.querySelectorAll(".btn-play").forEach(e=>{e.classList.remove("bg-success","text-success-foreground"),e.classList.add("bg-card","text-success"),e.querySelector(".icon-play")?.classList.remove("hidden"),e.querySelector(".icon-eq")?.classList.add("hidden")}),g=e=>{e.classList.remove("bg-card","text-success"),e.classList.add("bg-success","text-success-foreground"),e.querySelector(".icon-play")?.classList.add("hidden"),e.querySelector(".icon-eq")?.classList.remove("hidden"),e.focus({preventScroll:!0})},S=async e=>{if(e<0||e>=i.length)return;r=e;const a=i[r];let o,c,d,w;if(window.audioPlaylist&&window.audioPlaylist[r]){const u=window.audioPlaylist[r];o=u.play_url,c=u.title,d=u.artist,w=u.download_url}else o=a.dataset.audioSrc,c=a.dataset.title,d=a.dataset.author,w=a.dataset.download;y.textContent=c||"—",m.textContent=d||"—",f.href=w||o,t.pause(),t.src=o,t.load(),p(),g(a),L();try{await t.play(),n(!0)}catch(u){console.error("play()",u),n(!1)}},$=()=>{i=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")),i.forEach((e,a)=>{e.addEventListener("click",async o=>{o.preventDefault();const c=e.dataset.audioSrc;if(t.src===c){if(t.paused){r=a,p(),g(e),L();try{await t.play(),n(!0)}catch{}}else t.pause();return}S(a)})})};k.addEventListener("click",async()=>{if(t.paused)try{await t.play(),n(!0)}catch{}else t.pause(),n(!1)}),M.addEventListener("click",()=>{r>0&&S(r-1)}),I.addEventListener("click",()=>{r<i.length-1&&S(r+1)}),t.addEventListener("loadedmetadata",()=>{l.max=Math.floor(t.duration||0),O.textContent=h(t.duration||0)}),t.addEventListener("timeupdate",()=>{v||(l.value=Math.floor(t.currentTime||0)),A.textContent=h(t.currentTime||0)});const E=()=>{const e=Number(l.value||0);Number.isFinite(e)&&(t.currentTime=e),v=!1};l.addEventListener("input",()=>{v=!0,A.textContent=h(Number(l.value))}),l.addEventListener("change",E),l.addEventListener("mouseup",E),l.addEventListener("touchend",E,{passive:!0}),N.addEventListener("input",()=>t.volume=Number(N.value)),C.addEventListener("change",()=>t.playbackRate=Number(C.value.replace("x",""))),t.addEventListener("ended",()=>{n(!1),p()});const P=e=>{if(r<0||r>=i.length)return;const a=i[r];a.querySelector(".icon-eq")?.classList.toggle("hidden",!e),a.querySelector(".icon-play")?.classList.toggle("hidden",e)};t.addEventListener("play",()=>{n(!0),P(!0)}),t.addEventListener("pause",()=>{n(!1),P(!1)});const T="pl-state";let R=0;const b=()=>{try{const e={src:t.currentSrc||t.src||"",title:y.textContent||"",author:m.textContent||"",download:f.getAttribute("href")||"",index:r,currentTime:Number(t.currentTime||0),paused:t.paused};localStorage.setItem(T,JSON.stringify(e))}catch{}};return t.addEventListener("timeupdate",()=>{const e=Date.now();e-R>1e3&&(R=e,b())}),t.addEventListener("play",()=>{b()}),t.addEventListener("pause",()=>{b()}),{bind:$,restore:async()=>{try{const e=localStorage.getItem(T);if(!e)return;const a=JSON.parse(e);if(!a||!a.src)return;const o=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")).find(d=>d.dataset.audioSrc===a.src);o?(i=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")),r=Number(o.dataset.index??-1),p(),g(o)):r=-1,y.textContent=a.title||"",m.textContent=a.author||"",f.href=a.download||a.src,t.pause(),t.src=a.src,t.load(),L();const c=Number(a.currentTime||0);if(Number.isFinite(c)&&c>0&&t.addEventListener("loadedmetadata",function d(){t.removeEventListener("loadedmetadata",d);try{t.currentTime=c}catch{}}),a.paused===!1)try{await t.play(),n(!0)}catch{}else n(!1)}catch{}}}})();document.addEventListener("DOMContentLoaded",()=>{x.bind();const s=location.pathname;!/^(?:\/admin|\/editor)\b/.test(s)&&typeof x.restore=="function"&&x.restore()});
