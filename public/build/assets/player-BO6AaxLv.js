const k=(()=>{const r=t=>document.getElementById(t),e=r("pl-audio"),q=r("sticky-player"),A=r("pl-play"),F=r("pl-play-icon"),M=r("pl-pause-icon"),D=r("pl-prev"),I=r("pl-next"),h=r("pl-title"),L=r("pl-author"),c=r("pl-seek"),C=r("pl-current"),$=r("pl-duration"),v=r("pl-volume"),m=r("pl-rate"),b=r("pl-download");let d=[],s=-1,g=!1;const S=t=>Number.isFinite(t)?`${Math.floor(t/60)}:${String(Math.floor(t%60)).padStart(2,"0")}`:"0:00",E=()=>{q.classList.remove("hidden"),requestAnimationFrame(()=>q.classList.remove("opacity-0","translate-y-2"))},o=t=>{F.classList.toggle("hidden",t),M.classList.toggle("hidden",!t),A.setAttribute("aria-label",t?"Pausar":"Reproducir")},f=()=>document.querySelectorAll(".btn-play").forEach(t=>{t.classList.remove("bg-success","text-success-foreground"),t.classList.add("bg-card","text-success"),t.querySelector(".icon-play")?.classList.remove("hidden"),t.querySelector(".icon-eq")?.classList.add("hidden")}),w=t=>{t.classList.remove("bg-card","text-success"),t.classList.add("bg-success","text-success-foreground"),t.querySelector(".icon-play")?.classList.add("hidden"),t.querySelector(".icon-eq")?.classList.remove("hidden"),t.focus({preventScroll:!0})},x=async t=>{if(t<0||t>=d.length)return;s=t;const a=d[s];let i,l,n,y;if(window.audioPlaylist&&window.audioPlaylist[s]){const u=window.audioPlaylist[s];i=u.play_url,l=u.title,n=u.artist,y=u.download_url}else i=a.dataset.audioSrc,l=a.dataset.title,n=a.dataset.author,y=a.dataset.download;h.textContent=l||"—",L.textContent=n||"—",b.href=y||i,e.pause(),e.src=i,e.load(),f(),w(a),E();try{await e.play(),o(!0)}catch(u){console.error("play()",u),o(!1)}},O=()=>{d=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")),d.forEach((t,a)=>{t.addEventListener("click",async i=>{i.preventDefault();const l=t.dataset.audioSrc;if(e.src===l){if(e.paused){s=a,f(),w(t),E();try{await e.play(),o(!0)}catch{}}else e.pause();return}x(a)})})};A.addEventListener("click",async()=>{if(e.paused)try{await e.play(),o(!0)}catch{}else e.pause(),o(!1)}),D.addEventListener("click",()=>{s>0&&x(s-1)}),I.addEventListener("click",()=>{s<d.length-1&&x(s+1)}),e.addEventListener("loadedmetadata",()=>{c.max=Math.floor(e.duration||0),$.textContent=S(e.duration||0)}),e.addEventListener("timeupdate",()=>{g||(c.value=Math.floor(e.currentTime||0)),C.textContent=S(e.currentTime||0)});const N=()=>{const t=Number(c.value||0);Number.isFinite(t)&&(e.currentTime=t),g=!1};c.addEventListener("input",()=>{g=!0,C.textContent=S(Number(c.value))}),c.addEventListener("change",N),c.addEventListener("mouseup",N),c.addEventListener("touchend",N,{passive:!0}),v.addEventListener("input",()=>e.volume=Number(v.value)),m.addEventListener("change",()=>e.playbackRate=Number(m.value.replace("x",""))),e.addEventListener("ended",()=>{o(!1),f()});const P=t=>{if(s<0||s>=d.length)return;const a=d[s];a.querySelector(".icon-eq")?.classList.toggle("hidden",!t),a.querySelector(".icon-play")?.classList.toggle("hidden",t)};e.addEventListener("play",()=>{o(!0),P(!0)}),e.addEventListener("pause",()=>{o(!1),P(!1)});const R="pl-state";let T=0;const p=()=>{try{const t={src:e.currentSrc||e.src||"",title:h.textContent||"",author:L.textContent||"",download:b.getAttribute("href")||"",index:s,currentTime:Number(e.currentTime||0),paused:e.paused,volume:Number(e.volume??1),rate:Number(e.playbackRate??1)};localStorage.setItem(R,JSON.stringify(t))}catch{}};return e.addEventListener("timeupdate",()=>{const t=Date.now();t-T>1e3&&(T=t,p())}),e.addEventListener("play",()=>{p()}),e.addEventListener("pause",()=>{p()}),window.addEventListener("beforeunload",p),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&p()}),{bind:O,restore:async()=>{try{const t=localStorage.getItem(R);if(!t)return;const a=JSON.parse(t);if(!a||!a.src)return;const i=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")).find(n=>n.dataset.audioSrc===a.src);if(i?(d=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")),s=Number(i.dataset.index??-1),f(),w(i)):s=-1,h.textContent=a.title||"",L.textContent=a.author||"",b.href=a.download||a.src,e.pause(),e.src=a.src,e.load(),E(),Number.isFinite(a.volume)){try{e.volume=Math.max(0,Math.min(1,Number(a.volume)))}catch{}v&&(v.value=String(e.volume))}if(Number.isFinite(a.rate)&&a.rate>0){try{e.playbackRate=Number(a.rate)}catch{}if(m){const n=`${e.playbackRate}x`;[...m.options].some(y=>y.value===n)&&(m.value=n)}}const l=Number(a.currentTime||0);if(Number.isFinite(l)&&l>0&&e.addEventListener("loadedmetadata",function n(){e.removeEventListener("loadedmetadata",n);try{e.currentTime=l}catch{}}),a.paused===!1)try{await e.play(),o(!0)}catch{}else o(!1)}catch{}}}})();document.addEventListener("DOMContentLoaded",()=>{k.bind();const r=location.pathname;!/^(?:\/admin|\/editor)\b/.test(r)&&typeof k.restore=="function"&&k.restore()});
