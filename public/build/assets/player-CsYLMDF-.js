const S=(()=>{const s=e=>document.getElementById(e),t=s("pl-audio"),w=s("sticky-player"),x=s("pl-play"),D=s("pl-play-icon"),F=s("pl-pause-icon"),M=s("pl-prev"),I=s("pl-next"),p=s("pl-title"),y=s("pl-author"),l=s("pl-seek"),q=s("pl-current"),O=s("pl-duration"),k=s("pl-volume"),N=s("pl-rate"),m=s("pl-download");let c=[],r=-1,f=!1;const v=e=>Number.isFinite(e)?`${Math.floor(e/60)}:${String(Math.floor(e%60)).padStart(2,"0")}`:"0:00",A=()=>{w.classList.remove("hidden"),requestAnimationFrame(()=>w.classList.remove("opacity-0","translate-y-2"))},o=e=>{D.classList.toggle("hidden",e),F.classList.toggle("hidden",!e),x.setAttribute("aria-label",e?"Pausar":"Reproducir")},h=()=>document.querySelectorAll(".btn-play").forEach(e=>{e.classList.remove("bg-success","text-success-foreground"),e.classList.add("bg-card","text-success"),e.querySelector(".icon-play")?.classList.remove("hidden"),e.querySelector(".icon-eq")?.classList.add("hidden")}),C=e=>{e.classList.remove("bg-card","text-success"),e.classList.add("bg-success","text-success-foreground"),e.querySelector(".icon-play")?.classList.add("hidden"),e.querySelector(".icon-eq")?.classList.remove("hidden"),e.focus({preventScroll:!0})},L=async e=>{if(e<0||e>=c.length)return;r=e;const a=c[r];let n,i,d,E;if(window.audioPlaylist&&window.audioPlaylist[r]){const u=window.audioPlaylist[r];n=u.play_url,i=u.title,d=u.artist,E=u.download_url}else n=a.dataset.audioSrc,i=a.dataset.title,d=a.dataset.author,E=a.dataset.download;p.textContent=i||"—",y.textContent=d||"—",m.href=E||n,t.pause(),t.src=n,t.load(),h(),C(a),A();try{await t.play(),o(!0)}catch(u){console.error("play()",u),o(!1)}},$=()=>{c=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")),c.forEach((e,a)=>{e.addEventListener("click",n=>{n.preventDefault(),L(a)})})};x.addEventListener("click",async()=>{if(t.paused)try{await t.play(),o(!0)}catch{}else t.pause(),o(!1)}),M.addEventListener("click",()=>{r>0&&L(r-1)}),I.addEventListener("click",()=>{r<c.length-1&&L(r+1)}),t.addEventListener("loadedmetadata",()=>{l.max=Math.floor(t.duration||0),O.textContent=v(t.duration||0)}),t.addEventListener("timeupdate",()=>{f||(l.value=Math.floor(t.currentTime||0)),q.textContent=v(t.currentTime||0)});const g=()=>{const e=Number(l.value||0);Number.isFinite(e)&&(t.currentTime=e),f=!1};l.addEventListener("input",()=>{f=!0,q.textContent=v(Number(l.value))}),l.addEventListener("change",g),l.addEventListener("mouseup",g),l.addEventListener("touchend",g,{passive:!0}),k.addEventListener("input",()=>t.volume=Number(k.value)),N.addEventListener("change",()=>t.playbackRate=Number(N.value.replace("x",""))),t.addEventListener("ended",()=>{o(!1),h()});const P=e=>{if(r<0||r>=c.length)return;const a=c[r];a.querySelector(".icon-eq")?.classList.toggle("hidden",!e),a.querySelector(".icon-play")?.classList.toggle("hidden",e)};t.addEventListener("play",()=>{o(!0),P(!0)}),t.addEventListener("pause",()=>{o(!1),P(!1)});const T="pl-state";let R=0;const b=()=>{try{const e={src:t.currentSrc||t.src||"",title:p.textContent||"",author:y.textContent||"",download:m.getAttribute("href")||"",index:r,currentTime:Number(t.currentTime||0),paused:t.paused};localStorage.setItem(T,JSON.stringify(e))}catch{}};return t.addEventListener("timeupdate",()=>{const e=Date.now();e-R>1e3&&(R=e,b())}),t.addEventListener("play",()=>{b()}),t.addEventListener("pause",()=>{b()}),{bind:$,restore:async()=>{try{const e=localStorage.getItem(T);if(!e)return;const a=JSON.parse(e);if(!a||!a.src)return;const n=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")).find(d=>d.dataset.audioSrc===a.src);n?(c=Array.from(document.querySelectorAll(".btn-play[data-audio-src]")),r=Number(n.dataset.index??-1),h(),C(n)):r=-1,p.textContent=a.title||"",y.textContent=a.author||"",m.href=a.download||a.src,t.pause(),t.src=a.src,t.load(),A();const i=Number(a.currentTime||0);if(Number.isFinite(i)&&i>0&&t.addEventListener("loadedmetadata",function d(){t.removeEventListener("loadedmetadata",d);try{t.currentTime=i}catch{}}),a.paused===!1)try{await t.play(),o(!0)}catch{}else o(!1)}catch{}}}})();document.addEventListener("DOMContentLoaded",()=>{S.bind();const s=location.pathname;!/^(?:\/admin|\/editor)\b/.test(s)&&typeof S.restore=="function"&&S.restore()});
