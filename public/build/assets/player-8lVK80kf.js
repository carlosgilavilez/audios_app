document.addEventListener("DOMContentLoaded",function(){({audio:document.getElementById("pl-audio"),stickyPlayer:document.getElementById("sticky-player"),elements:{play:document.querySelectorAll('[id^="pl-play"]'),playIcon:document.querySelectorAll('[id^="pl-play-icon"]'),pauseIcon:document.querySelectorAll('[id^="pl-pause-icon"]'),prev:document.querySelectorAll('[id^="pl-prev"]'),next:document.querySelectorAll('[id^="pl-next"]'),back10:document.querySelectorAll('[id^="pl-back-10"]'),forward10:document.querySelectorAll('[id^="pl-forward-10"]'),title:document.querySelectorAll('[id^="pl-title"]'),author:document.querySelectorAll('[id^="pl-author"]'),category:document.querySelectorAll('[id^="pl-category"]'),series:document.querySelectorAll('[id^="pl-series"]'),dateMeta:document.querySelectorAll('[id^="pl-date"]'),current:document.querySelectorAll('[id^="pl-current"]'),duration:document.querySelectorAll('[id^="pl-duration"]'),seek:document.querySelectorAll('[id^="pl-seek"]'),volume:document.getElementById("pl-volume"),volumeToggle:document.getElementById("pl-volume-toggle"),download:document.querySelectorAll('[id^="pl-download"]'),expand:document.getElementById("pl-expand"),collapse:document.getElementById("pl-collapse"),minimizedPlayer:document.getElementById("minimized-player"),expandedPlayer:document.getElementById("expanded-player")},state:{playlist:[],currentIndex:-1,isPlaying:!1,isMuted:!1,activeButton:null},init(){if(!this.audio){console.error("Audio element #pl-audio not found.");return}this.collectPlaylist(),this.bindEventListeners()},collectPlaylist(){const e=document.querySelectorAll(".btn-play[data-audio-src]");this.state.playlist=Array.from(e).map((t,i)=>({src:t.dataset.audioSrc,title:t.dataset.title||"Pista sin tï¿½tulo",author:t.dataset.author||"Autor desconocido",category:t.dataset.category||"",series:t.dataset.series||"",date:t.dataset.date||"",download:t.dataset.download,button:t}))},bindEventListeners(){this.state.playlist.forEach((e,t)=>{e.button.addEventListener("click",i=>{i.preventDefault(),this.state.currentIndex===t?this.togglePlayPause():this.playTrack(t)})}),this.elements.play.forEach(e=>e.addEventListener("click",()=>this.togglePlayPause())),this.elements.next.forEach(e=>e.addEventListener("click",()=>this.playNext())),this.elements.prev.forEach(e=>e.addEventListener("click",()=>this.playPrev())),this.elements.back10.forEach(e=>e.addEventListener("click",()=>this.audio.currentTime-=10)),this.elements.forward10.forEach(e=>e.addEventListener("click",()=>this.audio.currentTime+=10)),this.audio.addEventListener("timeupdate",()=>this.updateProgress()),this.audio.addEventListener("loadedmetadata",()=>this.updateDuration()),this.audio.addEventListener("ended",()=>this.playNext()),this.audio.addEventListener("play",()=>this.updatePlayState(!0)),this.audio.addEventListener("pause",()=>this.updatePlayState(!1)),this.elements.seek.forEach(e=>e.addEventListener("input",t=>this.seek(t.target.value))),this.elements.volume.addEventListener("input",e=>this.setVolume(e.target.value)),this.elements.volumeToggle.addEventListener("click",()=>this.toggleMute()),this.elements.expand&&this.elements.expand.addEventListener("click",()=>this.expandPlayer()),this.elements.collapse&&this.elements.collapse.addEventListener("click",()=>this.collapsePlayer())},playTrack(e){if(e<0||e>=this.state.playlist.length){console.warn(`Invalid track index: ${e}`);return}this.state.currentIndex=e;const t=this.state.playlist[e];this.audio.src=t.src,this.updateMetadata(t),this.audio.play().catch(i=>console.error("Error playing audio:",i)),this.stickyPlayer.classList.contains("hidden")&&(this.stickyPlayer.classList.remove("hidden","opacity-0","-translate-y-2","translate-y-2"),typeof lucide<"u"&&lucide.createIcons())},updatePlayState(e){this.state.isPlaying=e,this.updateNodeList(this.elements.playIcon,t=>t.classList.toggle("hidden",e)),this.updateNodeList(this.elements.pauseIcon,t=>t.classList.toggle("hidden",!e)),this.updateActiveButton(e)},updateActiveButton(e){this.state.activeButton&&this.setButtonState(this.state.activeButton,!1);const t=this.state.playlist[this.state.currentIndex];t&&(this.state.activeButton=t.button,this.setButtonState(this.state.activeButton,e))},setButtonState(e,t){const i=e.querySelector(".icon-play"),s=e.querySelector(".icon-eq");i&&i.classList.toggle("hidden",t),s&&s.classList.toggle("hidden",!t)},updateMetadata(e){this.updateNodeList(this.elements.title,t=>t.textContent=e.title),this.updateNodeList(this.elements.author,t=>t.textContent=e.author),this.updateNodeList(this.elements.download,t=>{e.download?(t.href=e.download,t.style.display="inline-flex"):t.style.display="none"}),this.updateMetaField(this.elements.category,e.category),this.updateMetaField(this.elements.series,e.series),this.updateMetaField(this.elements.dateMeta,e.date)},togglePlayPause(){this.state.isPlaying?this.audio.pause():this.state.currentIndex===-1?this.playTrack(0):this.audio.play().catch(e=>console.error("Error resuming audio:",e))},playNext(){let e=this.state.currentIndex+1;e>=this.state.playlist.length&&(e=0),this.playTrack(e)},playPrev(){let e=this.state.currentIndex-1;e<0&&(e=this.state.playlist.length-1),this.playTrack(e)},updateProgress(){if(isNaN(this.audio.duration))return;const e=this.audio.currentTime/this.audio.duration*100;this.updateNodeList(this.elements.seek,t=>t.value=e),this.updateNodeList(this.elements.current,t=>t.textContent=this.formatTime(this.audio.currentTime))},updateDuration(){this.updateNodeList(this.elements.duration,e=>e.textContent=this.formatTime(this.audio.duration))},seek(e){isNaN(this.audio.duration)||(this.audio.currentTime=this.audio.duration/100*e)},setVolume(e){this.audio.volume=e,this.audio.muted=e==0,this.state.isMuted=e==0},toggleMute(){this.audio.muted=!this.audio.muted,this.state.isMuted=this.audio.muted},expandPlayer(){document.body.classList.add("player-expanded"),typeof lucide<"u"&&lucide.createIcons()},collapsePlayer(){document.body.classList.remove("player-expanded")},formatTime(e){const t=Math.floor(e/60),i=Math.floor(e%60);return`${t}:${i<10?"0":""}${i}`},updateNodeList(e,t){e.forEach(i=>t(i))}}).init()});
